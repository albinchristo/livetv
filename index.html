<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Soccer Events</title>
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f3f4f6;
            color: #333;
            margin: 20px;
            padding: 0;
            line-height: 1.6;
        }
        h1 {
            text-align: center;
            color: #444;
            font-size: 2rem;
            margin-bottom: 30px;
            font-weight: 700;
        }
        .event {
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #fff;
            overflow: hidden;
            cursor: pointer;
            transition: box-shadow 0.3s ease;
        }
        .event:hover {
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .event-header {
            padding: 12px 20px;
            background-color: #1e40af;
            color: #fff;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .event-title {
            font-size: 1rem;
        }
        .event-time {
            font-size: 0.85rem;
            color: #ddd;
        }
        .event-details {
            padding: 15px;
            display: none;
        }
        .iframe-container {
            margin-top: 15px;
        }
        iframe {
            border: none;
            width: 100%;
            height: 450px;
            border-radius: 8px;
        }
        .event-date {
            font-size: 1.25rem;
            font-weight: bold;
            color: #1e3a8a;
            margin: 20px 0 10px;
            text-transform: uppercase;
        }
        .link-list {
            margin-top: 10px;
            padding-left: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .link-item {
            display: inline-block;
            padding: 8px 16px;
            background-color: #1e40af;
            color: #fff;
            font-size: 0.9rem;
            font-weight: 600;
            text-decoration: none;
            border-radius: 5px;
            transition: background-color 0.3s ease, transform 0.2s ease;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .link-item:hover {
            background-color: #1d4ed8;
            transform: translateY(-2px);
        }
        .category-icon {
            font-size: 1.25rem;
            margin-right: 10px;
        }
        .hidden {
            display: none;
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
</head>
<body>
    <h1>Soccer Events</h1>
    <div id="events-container">Loading...</div>

    <script>
        async function fetchEvents() {
            try {
                const response = await fetch('https://sons-stream.com/api/v1/');
                const data = await response.json();
                displayEvents(data);
            } catch (error) {
                console.error('Error fetching events:', error);
                document.getElementById('events-container').innerHTML = 'Failed to load events.';
            }
        }

        function displayEvents(events) {
            const container = document.getElementById('events-container');
            container.innerHTML = ''; // Clear the loading text

            const eventsByDate = events.reduce((acc, event) => {
                const date = event.event_start.split(' ')[0];
                if (!acc[date]) acc[date] = [];
                acc[date].push(event);
                return acc;
            }, {});

            for (const [date, events] of Object.entries(eventsByDate)) {
                const dateHeader = document.createElement('div');
                dateHeader.className = 'event-date';
                dateHeader.textContent = new Date(date).toLocaleDateString(undefined, { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
                container.appendChild(dateHeader);

                events.forEach((event, index) => {
                    const eventDiv = document.createElement('div');
                    eventDiv.className = 'event';

                    const categoryIcon = getCategoryIcon(event.category_name);
                    const eventTime = new Date(event.event_start).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

                    eventDiv.innerHTML = `
                        <div class="event-header">
                            <span class="event-title">
                                <span class="category-icon">${categoryIcon}</span>
                                ${event.event_title.trim()}
                            </span>
                            <span class="event-time">${eventTime}</span>
                        </div>
                        <div class="event-details">
                            <p><strong>Start Time:</strong> ${event.event_start}</p>
                            <p><strong>League:</strong> ${event.league_name}</p>
                            <p><strong>Category:</strong> ${event.category_name}</p>
                            <div class="link-list"></div>
                        </div>
                    `;
                    container.appendChild(eventDiv);

                    // Add click event listener to toggle event details and display iframe links
                    eventDiv.querySelector('.event-header').addEventListener('click', () => {
                        const details = eventDiv.querySelector('.event-details');
                        const linkList = eventDiv.querySelector('.link-list');

                        if (details.style.display === 'block') {
                            details.style.display = 'none';
                            linkList.innerHTML = ''; // Clear links
                        } else {
                            details.style.display = 'block';
                            linkList.innerHTML = ''; // Clear previous links

                            const iframes = event.channel_embeds.split(',');
                            iframes.forEach((iframe, idx) => {
                                const encodedSrc = btoa(iframe.match(/src="([^"]+)"/)[1]);
                                const link = document.createElement('a');
                                link.href = `https://todopelotatvhd.com/embed/eventos.html?r=${encodedSrc}`;
                                link.target = '_blank';
                                link.textContent = `Link ${idx + 1}`;
                                link.className = 'link-item';
                                linkList.appendChild(link);
                            });
                        }
                    });
                });
            }
        }

        function getCategoryIcon(category) {
            const icons = {
                soccer: '‚öΩ',
                basketball: 'üèÄ',
                tennis: 'üéæ',
                // Add more categories and icons as needed
            };
            return icons[category.toLowerCase()] || 'üèÖ';
        }

        // Fetch and display events on page load
        fetchEvents();
    </script>
</body>
</html>
